# ๐ Diagrama Visual - Cรกlculos de Lucro e Rentabilidade

## ๐ฏ Exemplo Prรกtico Completo

Vamos acompanhar um pedido real do inรญcio ao fim:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      PEDIDO NO MERCADO LIVRE                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                    โ
โ  Order ID: 12345678                                              โ
โ  SKU: GP0080                                                     โ
โ  Quantidade: 2 unidades                                          โ
โ  Preรงo Unitรกrio: R$ 99,90                                        โ
โ  Data: 05/12/2025 17:38:31                                       โ
โ  Tipo Envio: FULL (Fulfillment)                                  โ
โ  Status: PAID                                                    โ
โ                                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฐ FLUXO DE CรLCULO - PASSO A PASSO

### **ETAPA 1: Dados Brutos**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   DADOS DO PEDIDO                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                      โ
โ  Preรงo Unitรกrio (unit_price):      R$  99,90      โ
โ  Quantidade (quantity):             2 unidades    โ
โ  Taxa por unidade (sale_fee):       R$   7,99     โ
โ  Tipo Envio:                        FULFILLMENT    โ
โ  Shipment ID:                       67890          โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### **ETAPA 2: Buscar Informaรงรตes Complementares**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              CONSULTAR NA API DO ML                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                      โ
โ  GET /shipments/67890                              โ
โ  โโโ logistic_type: "fulfillment"                  โ
โ                                                      โ
โ  GET /shipments/67890/costs                        โ
โ  โโโ senders[0].save: 0 (FULL nรฃo cobra frete)     โ
โ                                                      โ
โ  SELECT * FROM estoque WHERE sku='GP0080'          โ
โ  โโโ preco_custo: 45,50                            โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### **ETAPA 3: Calcular Valores Intermediรกrios**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CรLCULOS INTERMEDIรRIOS                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ RECEITA BRUTA โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                   โ
โ  Valor Vendido Total = Preรงo Unit. ร Quantidade                 โ
โ                      = R$ 99,90 ร 2                            โ
โ                      = R$ 199,80 โ                             โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ TAXAS E CUSTOS โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                   โ
โ  1. Taxa ML Total = Taxa Unit. ร Quantidade                     โ
โ                   = R$ 7,99 ร 2                                โ
โ                   = R$ 15,98 โ                                 โ
โ                                                                   โ
โ  2. Comissรฃo = Valor Vendido Total ร 7,41%                     โ
โ              = R$ 199,80 ร 0,0741                              โ
โ              = R$ 14,80 โ                                      โ
โ                                                                   โ
โ  3. Frete = Verificar se >= R$ 79,00                           โ
โ           = R$ 199,80 >= R$ 79,00? SIM                        โ
โ           = Frete: R$ 0,00 (FULL รฉ grรกtis) โ                 โ
โ                                                                   โ
โ  4. CTL (Custo Logรญstico) = R$ 1,20 ร Quantidade              โ
โ                           = R$ 1,20 ร 2                       โ
โ                           = R$ 2,40 โ                         โ
โ                                                                   โ
โ  5. Imposto = Valor Vendido Total ร 9,2%                       โ
โ            = R$ 199,80 ร 0,092                                โ
โ            = R$ 18,38 โ                                       โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ CUSTO DE AQUISIรรO โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                   โ
โ  Valor Comprado = Preรงo de Custo ร Quantidade                  โ
โ                = R$ 45,50 ร 2                                 โ
โ                = R$ 91,00 โ                                   โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### **ETAPA 4: Calcular Valor Lรญquido**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      VALOR LรQUIDO                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Fรณrmula:
  VALOR LรQUIDO = Valor Vendido - Taxas - Frete - CTL - Comissรฃo

Cรกlculo:
  VALOR LรQUIDO = R$ 199,80 - R$ 15,98 - R$ 0,00 - R$ 2,40 - R$ 14,80
                = R$ 166,62 โ

Diagrama Visual:
  
  Valor Vendido Total:     R$ 199,80  โโโโโโโโโโโโโโโโโโโโ (100%)
  
  - Taxa ML:               - R$ 15,98 โโโโโโ (8,0%)
  - Comissรฃo:              - R$ 14,80 โโโโโโ (7,4%)
  - Frete:                 - R$ 0,00  โโ (0,0%)
  - CTL:                   - R$ 2,40  โโ (1,2%)
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  Valor Lรญquido:           R$ 166,62 โโโโโโโโโโโโโโโ (83,4%)
```

---

### **ETAPA 5: Calcular Lucro Bruto**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      LUCRO BRUTO                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Fรณrmula:
  LUCRO = Valor Lรญquido - Valor Comprado

Cรกlculo:
  LUCRO = R$ 166,62 - R$ 91,00
        = R$ 75,62 โ

Diagrama:
  
  Valor Lรญquido:    R$ 166,62 โโโโโโโโโโโโโโโ 
  
  - Custo Produto:  - R$ 91,00 โโโโโโโโโโ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  LUCRO BRUTO:      R$ 75,62 โโโโโ
```

---

### **ETAPA 6: Calcular MARKUP (% sobre custo)**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  MARKUP - Margem Sobre Custo                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Fรณrmula:
  MARKUP = (Lucro / Valor Comprado) ร 100

Cรกlculo:
  MARKUP = (R$ 75,62 / R$ 91,00) ร 100
         = 0,8309 ร 100
         = 83,09% โ

Interpretaรงรฃo:
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ Para cada R$ 100,00 de CUSTO:                       โ
  โ Vocรช ganha R$ 83,09 de LUCRO                        โ
  โ                                                      โ
  โ Investiu:  R$ 100,00                               โ
  โ Ganhou:    +R$ 83,09                               โ
  โ Total:     R$ 183,09                               โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Escala Visual:
  Valor Comprado: R$ 91,00 โโโโโโโโโโ (100%)
  Lucro:          R$ 75,62 โโโโโโโโ (83,09%)
                           โโโโโโโโโ
                  Total:   R$ 166,62 (183,09% do custo)
```

---

### **ETAPA 7: Calcular Margem de Lucro (% sobre venda)**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              MARGEM DE LUCRO - Rentabilidade da Venda             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Fรณrmula:
  MARGEM = (Lucro / Valor Vendido) ร 100

Cรกlculo:
  MARGEM = (R$ 75,62 / R$ 199,80) ร 100
         = 0,3785 ร 100
         = 37,85% โ

Interpretaรงรฃo:
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ De cada R$ 100,00 VENDIDO:                          โ
  โ Vocรช fica com R$ 37,85 de LUCRO                     โ
  โ                                                      โ
  โ Receita bruta:    R$ 100,00                        โ
  โ Lucro puro:       R$ 37,85                         โ
  โ Custos & Taxas:   R$ 62,15                         โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Escala Visual:
  Valor Vendido: R$ 199,80 โโโโโโโโโโโโโโโโโโโโ (100%)
  
  - Taxas & Custos: โโโโโโโโโโโโโโ (62,15%)
  - LUCRO:          โโโโโโโโ (37,85%) โ Fica com vocรช!
```

---

## ๐ RESUMO FINAL DO PEDIDO

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   RESUMO COMPLETO DO PEDIDO                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

IDENTIFICAรรO:
  โโ Order ID:           12345678
  โโ SKU:                GP0080
  โโ Quantidade:         2 unidades
  โโ Data:               05/12/2025 17:38:31
  โโ Tipo Envio:         FULL (Fulfillment)

RECEITA:
  โโ Preรงo Unitรกrio:     R$  99,90
  โโ Valor Vendido:      R$ 199,80 โ

CUSTOS E DEDUรรES:
  โโ Valor Comprado:     R$  91,00
  โโ Taxa ML:            R$  15,98
  โโ Comissรฃo (7.41%):   R$  14,80
  โโ Frete:              R$   0,00 (FULL grรกtis)
  โโ CTL:                R$   2,40
  โโ Imposto (9.2%):     R$  18,38
  
RESULTADO:
  โโ Valor Lรญquido:      R$ 166,62
  โโ LUCRO BRUTO:        R$  75,62 โโโ
  
INDICADORES:
  โโ MARKUP:             83,09% (ganho sobre custo)
  โโ MARGEM DE LUCRO:    37,85% (ganho sobre venda)

STATUS NO BANCO:
  โโ Inserido em:        2025-12-05 17:38:45
  โโ Prรณxima atualizaรงรฃo: 2025-12-05 18:08:45

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Comparaรงรฃo: Diferentes Tipos de Envio

```
MESMO PEDIDO COM DIFERENTES TIPOS DE ENVIO:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         TIPO: FULL                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Valor Vendido: R$ 199,80                                         โ
โ Frete: R$ 0,00 (FULL paga)      โ MELHOR                        โ
โ CTL: R$ 2,40 (1.20 ร qty)                                       โ
โ Valor Lรญquido: R$ 166,62                                        โ
โ Lucro: R$ 75,62                                                  โ
โ Margem: 37,85%                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         TIPO: FLEX                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Valor Vendido: R$ 199,80                                         โ
โ Frete: -R$ 13,68 (vocรช paga)    โ PIOR                         โ
โ CTL: R$ 6,00 (fixo)                                             โ
โ Valor Lรญquido: R$ 146,94                                        โ
โ Lucro: R$ 55,94                                                  โ
โ Margem: 27,98% (10% MENOS do que FULL)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Diferenรงa:
  FULL vs FLEX:
  โโ Lucro a mais: R$ 19,68 (35% maior com FULL)
  โโ Margem a mais: 9,87% pontos percentuais
```

---

## ๐ Grรกfico de Distribuiรงรฃo

```
PARA CADA R$ 100,00 VENDIDOS (TIPO FULL):

Composiรงรฃo dos Custos:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโ Vocรช fica (37,85%)โ  โ LUCRO
โโโโโโโโโ Frete (0%)                     โ  (FULL paga)
โโโโโโ Taxas ML (8%)                     โ
โโโโโ Comissรฃo (7,41%)                   โ
โโโ CTL (1,2%)                           โ
โโโโโโโโโ Imposto (9,2%)                 โ
โโโโโโโโโ Custo Produto (45,62%)         โ  โ Menos do que recebe
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
100%
```

---

## ๐ Resumo Educativo

| Conceito | Fรณrmula | O que significa |
|----------|---------|-----------------|
| **Valor Vendido** | Preรงo ร Qtd | Quanto vocรช recebeu bruto |
| **Valor Lรญquido** | Vendido - Taxas - Custos | O quanto sobra antes do lucro |
| **Valor Comprado** | Preรงo Custo ร Qtd | Quanto vocรช pagou pelo produto |
| **LUCRO** | Lรญquido - Comprado | **Ganho REAL** |
| **MARKUP** | (Lucro / Comprado) ร 100 | Ganho % sobre investimento |
| **MARGEM** | (Lucro / Vendido) ร 100 | Ganho % sobre faturamento |

---

## โ๏ธ Casos Especiais

### Caso 1: Valor Vendido < R$ 79,00
```
Se valor_vendido < 79.00:
  - Cliente NรO ganha frete grรกtis
  - Vocรช precisa pagar frete
  - Lucro diminui significativamente
  
Exemplo: Vendeu R$ 50,00
  โ Vocรช paga frete de R$ 13,68
  โ Lucro reduz bastante
```

### Caso 2: SKU Nรฃo Cadastrado
```
Se SKU nรฃo existir no cache (estoque):
  - consultarValorSKU() retorna 0
  - Valor Comprado = 0
  - Markup fica infinito (divisรฃo por zero)
  
Aviso: Sempre cadastre SKUs na tabela estoque!
```

### Caso 3: Lucro Negativo
```
Se Valor Lรญquido < Valor Comprado:
  - lucro < 0
  - Vocรช estรก PERDENDO dinheiro
  - Rever pricing!
  
Exemplo ruim: Preรงo custo R$ 100, vendeu R$ 90
             โ Lucro = -R$ 10 (prejuรญzo!)
```

---

## ๐ Prรณximos Passos

1. **Criar tabela no Supabase**: Execute `SCHEMA_VENDAS_ML.sql`
2. **Testar sincronizaรงรฃo**: Railway vai preencher a tabela
3. **Verificar dados**: Abra SQL Editor do Supabase
4. **Analisar lucros**: Use as queries de exemplo

Sucesso! ๐
